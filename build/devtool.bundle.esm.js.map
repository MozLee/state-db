{"version":3,"file":"devtool.bundle.esm.js","sources":["../src/devTool/render/icon.js","../src/devTool/render/renderHTML.js","../src/devTool/render/renderConsole.js","../src/utils.js","../src/devTool/index.js"],"sourcesContent":["export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB60lEQVRYR83XPeiPURTA8c8/ZfFOyKhQXjZFUcJMUjZGNoMor5kMDMhg89+UhUGxyICSSQavhcHonVBGOrqPHk+/+/9dPNfPHZ97Oud7Xp9zx4z4jI3YvhzAzQS2fgjgMLlNOIgVSc9DHMO1Rm8O4FsSGBahieTC+JWMA5txNe5qAtzGWlzCYUxK3m/DnXRXFeAzpmIxnqdILMMjvMec2hH4iBlYgmcJIGrhAT5gdm2AW1jXSsHklIKtiOLdUBtgFa5jeqcQIzUbcbc2QOhfiN3Yi+iY0ziLF/+iDduOZ9u1ZhtWBZiLA9iXrJzCSbzMDJ5eIzAzDZKlHWNvsKbV89UicA47M55ewPYBd71GIIZIRGHQieEzqzbAK8zLALzG/NoA57EjAzCOXbUBFqUijE5on6dYjUhD9/RaA6F8AfZjT7J0BscRKRh0egdojPz14vLfTcL2zyO8jAn3y8+jE99eI7ASNzCtY+RT+nff+53iKgVtp+AytqQF4mhSEBts7HBxF4tEcXX/CcAXTMFyPE4Kmh3uLbptFyK9puBd2tPC6JMOwM8lstSzUrl2Cpo1+iKO5NboUsWlcm2AoodEqeJSue4cCIhDqQ5CRzylTjSvmAFFeB9f0wjODMEfn7NPuGFPr4mU9nI3coDv5iyIIca8eRQAAAAASUVORK5CYII=\"","import icon from './icon.js';\n\nvar $ = selector => document.querySelector(selector)\nvar renderHTML = {\n    injectPage: (methods) => {\n        // methods.renderTable\n        // methods.renderAll\n        // methods.renderLine\n        // methods.getInfo\n        const info = methods.getInfo();\n        const tableNames = info.tableNames;\n        const tables = info.tables;\n        const db = info.db;\n        const opts = methods.getOpts();\n        const state = {\n            query: '',\n            tablename: 'all'\n        }\n\n        const renderFramework = () => {\n            $('#state-db-devtool') && document.body.removeChild($('#state-db-devtool'));\n            var devtoolWrapper = document.createElement('div');\n            devtoolWrapper.setAttribute('id', 'state-db-devtool');\n            devtoolWrapper.className = 'state-db-devtool';\n            devtoolWrapper.innerHTML =\n            `\n            <style>\n                .state-db-devtool {\n                    position: fixed;\n                    top :10px;\n                    right: 10px;\n                    height: 30px;\n                    width: 30px;\n                    z-index: 99999;\n                    background: url(\"${icon}\") center;\n                    background-size: cover;\n                }\n                .state-db-devtool-content {\n                    position: absolute;\n                    top: 30px;\n                    right: 0px;\n                    background: #fff;\n                    padding: 20px;\n                    width: 500px;\n                    border: 1px solid #c9c9c9;\n                    max-height: 650px;\n                    overflow: auto;\n                }\n\n                .state-db-table-scroll-wrapper {\n                    overflow: auto;\n                    max-height: 400px;\n                    max-width: 460px;\n                }\n                .state-db-devtool table {\n                    font-family: verdana,arial,sans-serif;\n                    font-size:11px;\n                    color:#333333;\n                    border-width: 1px;\n                    border-color: #999999;\n                    border-collapse: collapse;\n\n                }\n                .state-db-devtool table th {\n                    background:#b5cfd2;\n                    border-width: 1px;\n                    padding: 8px;\n                    border-style: solid;\n                    border-color: #999999;\n                }\n                .state-db-devtool table td {\n                    background:#dcddc0;\n                    border-width: 1px;\n                    padding: 8px;\n                    border-style: solid;\n                    border-color: #999999;\n                }\n            </style>\n            <div id=\"state-db-devtool-content\"  class=\"state-db-devtool-content\">\n                <select id=\"state-db-devtool-table-selector\">\n                    <option value=\"all\">all tables</option>\n                    ${tableNames.map(item => `<option value=\"${item}\">${item}</option>`)}\n                </select>\n                <input id=\"state-db-devtool-query-input\" type=\"text\">\n                <button id=\"state-db-devtool-query-submit\" >确认</button>\n                <div id=\"state-db-tables-wrapper\"></div>\n            </div>`;\n            document.body.appendChild(devtoolWrapper);\n        }\n\n        const renderData = () => {\n            const $tablesWrapper = $('#state-db-tables-wrapper');\n            $tablesWrapper.innerHTML = '';\n            if (state.tablename === 'all') {\n                methods.renderAll();\n            }\n            else if (state.tablename !== 'all' && !state.query) {\n                methods.renderTable(state.tablename);\n            }\n            else if (state.tablename !== 'all' && state.query) {\n\n            }\n        }\n\n        const bindEvent = () => {\n            const toggle = (el) => {\n                if (el.style.display==='none') {\n                    el.style.display = 'block'\n                }\n                else {\n                    el.style.display = 'none'\n                }\n            }\n            const $toggle = $('#state-db-devtool');\n            const $content = $('#state-db-devtool-content');\n            const $tableSelector = $('#state-db-devtool-table-selector');\n            const $refresh = $('#state-db-devtool-refresh');\n            //默认不展开\n            if (opts.hide) {\n                $content.style.display = 'none';\n            }\n\n            $toggle.onclick = (e) => {\n                if (e.target === $toggle) {\n                    toggle($content)\n                }\n            }\n\n            $tableSelector.onchange = (e) => {\n                // $tablesWrapper.innerHTML = '';\n                if (state.tablename !== e.target.value) {\n                    state.tablename = e.target.value;\n                    renderData();\n                }\n            }\n        }\n        renderFramework();\n        renderData();\n        bindEvent();\n        tables.forEach(table => table.unbindFn(renderData));\n        tables.forEach(table => table.bindFn(renderData)); //触发自动变化\n\n    },\n\n    renderArr: (arr, tablename) => {\n        var $tablesWrapper = $('#state-db-tables-wrapper');\n        var $tableWrapper = document.createElement('div');\n        $tableWrapper.className = 'state-db-table-wrapper';\n\n        var getColumns = () => {\n            let columns = [];\n            arr.forEach(item => {\n                columns = columns.concat(Object.keys(item))\n            })\n            return [...new Set(columns)];\n        }\n        var renderColumns = () => {\n            var str = ''\n            getColumns().forEach(key => {\n                str = str + '<th>' + key + '</th>'\n            });\n            return str;\n        }\n        var renderValues = () => {\n            var renderItem = (item) => {\n                var str = '';\n                var columns = getColumns();\n                var strArr = [];\n                for (let i = 0; i < columns.length; i++) {\n                    strArr.push('<td></td>');\n                }\n                for (let i in item) {\n                    var index = columns.indexOf(i);\n                    if ( index > -1) {\n                        strArr[index] = `<td>${item[i]}</td>`;\n                    }\n                }\n                return strArr.join('');\n            }\n            var str = ''\n            arr.forEach(item => str += `<tr>${renderItem(item)}</tr>`)\n            return str;\n        }\n\n        if (arr.length) {\n            $tableWrapper.innerHTML = `\n            <p>表名：${tablename}，count: ${arr.length}</p>\n            <div class=\"state-db-table-scroll-wrapper\">\n                <table>\n                    <tr>${renderColumns()}</tr>\n                    ${renderValues()}\n                </table>\n            </div>`\n        }\n        $tablesWrapper.appendChild($tableWrapper);\n    },\n\n    renderItem: (line) => {\n        console.table(line)\n    }\n}\n\nexport default renderHTML;","var renderConsole = {\n    injectPage: (methods) => {\n        window.showTable = methods.renderTable\n        window.showTableAll = methods.renderAll\n        window.showTableLine = methods.renderLine\n    },\n    renderArr: (arr, tablename) => {\n        console.log('******** ' + tablename + ' ********* , item_count: ' + arr.length);\n        console.table(arr);\n    },\n    renderItem: (line, tablename) => console.table(line)\n}\n\nexport default renderConsole;","const isArray = (v) => Object.prototype.toString.call(v) === \"[object Array]\"\nconst isObj = (v) => Object.prototype.toString.call(v) === \"[object Object]\"\nconst isFunction = (v) => Object.prototype.toString.call(v) === \"[object Function]\"\nconst isString = (v) => Object.prototype.toString.call(v) === \"[object String]\"\nconst isNumber = (v) => Object.prototype.toString.call(v) === \"[object Number]\"\n\nconst getType = (v) => {\n    var typeStr = Object.prototype.toString.call(v);\n    return typeStr.replace('[object ', '').replace(']', '');\n}\nconst errorHanle = (type, e) => {\n\n}\n\nexport {isArray, isObj, isFunction, isString, isNumber, getType, errorHanle}\n\n","/*\n * 接收一个db实例\n */\nimport renderHTML from './render/renderHTML.js';\nimport renderConsole from './render/renderConsole.js';\nimport {isObj} from '../utils';\n\n\nexport default (db, render=\"console\", opts={}) => {\n    let renderer = {};\n    if (render==\"console\") {\n        renderer = renderConsole;\n    }\n    else if (render==\"html\") {\n        renderer = renderHTML;\n    }\n\n    const renderArr = renderer.renderArr;\n\n    const renderItem = renderer.renderItem;\n\n    const renderTable = (name) => {\n        renderArr(db.table(name).getValues(), name);\n    }\n\n    const renderAll = () => {\n        const tables = db.getTables()\n        for (let i in tables) {\n            renderTable(i);\n        }\n    }\n\n    const getInfo = () => {\n        const tables = db.getTables()\n        const tableNames = [];\n        const tableList = [];\n        for (let i in tables) {\n            tableNames.push(i);\n            tableList.push(tables[i]);\n        }\n        return {\n            tables: tableList,\n            tableNames: tableNames,\n            db: db\n        }\n    }\n\n    const getOpts = () => {\n        if (isObj(opts)) {\n            return opts;\n        }\n        else {\n            return {};\n        }\n    }\n\n    const renderLine = (tablename, query) => {\n        renderArr(db.table(tablename).where(query).getValues(), tablename);\n    }\n\n\n    const exportMethods = {\n        renderAll,\n        renderTable,\n        renderLine,\n        getInfo,\n        getOpts\n    }\n\n    renderer.injectPage(exportMethods);\n    db.bindFn(() => {\n        console.log('injectPage', db);\n        renderer.injectPage(exportMethods);\n    })\n}\n\n"],"names":["$","selector","document","querySelector","renderHTML","injectPage","methods","info","getInfo","tableNames","tables","db","opts","getOpts","state","query","tablename","renderFramework","body","removeChild","devtoolWrapper","createElement","setAttribute","className","innerHTML","icon","map","item","appendChild","renderData","$tablesWrapper","renderAll","renderTable","bindEvent","toggle","el","style","display","$toggle","$content","$tableSelector","$refresh","hide","onclick","e","target","onchange","value","forEach","table","unbindFn","bindFn","renderArr","arr","$tableWrapper","getColumns","columns","concat","Object","keys","Set","renderColumns","str","key","renderValues","renderItem","strArr","i","length","push","index","indexOf","join","line","console","renderConsole","window","showTable","showTableAll","showTableLine","renderLine","log","isObj","v","prototype","toString","call","render","renderer","name","getValues","getTables","tableList","where","exportMethods"],"mappings":"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"}