{"version":3,"file":"devtool.bundle.js","sources":["../src/devTool/render/icon.js","../src/devTool/render/renderHTML.js","../src/devTool/render/renderConsole.js","../src/devTool/index.js"],"sourcesContent":["export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB60lEQVRYR83XPeiPURTA8c8/ZfFOyKhQXjZFUcJMUjZGNoMor5kMDMhg89+UhUGxyICSSQavhcHonVBGOrqPHk+/+/9dPNfPHZ97Oud7Xp9zx4z4jI3YvhzAzQS2fgjgMLlNOIgVSc9DHMO1Rm8O4FsSGBahieTC+JWMA5txNe5qAtzGWlzCYUxK3m/DnXRXFeAzpmIxnqdILMMjvMec2hH4iBlYgmcJIGrhAT5gdm2AW1jXSsHklIKtiOLdUBtgFa5jeqcQIzUbcbc2QOhfiN3Yi+iY0ziLF/+iDduOZ9u1ZhtWBZiLA9iXrJzCSbzMDJ5eIzAzDZKlHWNvsKbV89UicA47M55ewPYBd71GIIZIRGHQieEzqzbAK8zLALzG/NoA57EjAzCOXbUBFqUijE5on6dYjUhD9/RaA6F8AfZjT7J0BscRKRh0egdojPz14vLfTcL2zyO8jAn3y8+jE99eI7ASNzCtY+RT+nff+53iKgVtp+AytqQF4mhSEBts7HBxF4tEcXX/CcAXTMFyPE4Kmh3uLbptFyK9puBd2tPC6JMOwM8lstSzUrl2Cpo1+iKO5NboUsWlcm2AoodEqeJSue4cCIhDqQ5CRzylTjSvmAFFeB9f0wjODMEfn7NPuGFPr4mU9nI3coDv5iyIIca8eRQAAAAASUVORK5CYII=\"","import icon from './icon.js';\n\nvar $ = selector => document.querySelector(selector)\nvar renderHTML = {\n    injectPage: (methods) => {\n        // methods.renderTable\n        // methods.renderAll\n        // methods.renderLine\n        // methods.getInfo\n        const info = methods.getInfo();\n        const tableNames = info.tableNames;\n        const tables = info.tables;\n        const db = info.db;\n        const state = {\n            query: '',\n            tablename: 'all'\n        }\n\n        const renderFramework = () => {\n            $('#state-db-devtool') && document.body.removeChild($('#state-db-devtool'));\n            var devtoolWrapper = document.createElement('div');\n            devtoolWrapper.setAttribute('id', 'state-db-devtool');\n            devtoolWrapper.className = 'state-db-devtool';\n            devtoolWrapper.innerHTML =\n            `\n            <style>\n                .state-db-devtool {\n                    position: fixed;\n                    top :10px;\n                    right: 10px;\n                    height: 30px;\n                    width: 30px;\n                    z-index: 99999;\n                    background: url(\"${icon}\") center;\n                    background-size: cover;\n                }\n                .state-db-devtool-content {\n                    position: absolute;\n                    top: 30px;\n                    right: 0px;\n                    background: #fff;\n                    padding: 20px;\n                    width: 500px;\n                    border: 1px solid #c9c9c9;\n                    max-height: 650px;\n                    overflow: auto;\n                }\n\n                .state-db-table-scroll-wrapper {\n                    overflow: auto;\n                    max-height: 400px;\n                    max-width: 460px;\n                }\n                .state-db-devtool table {\n                    font-family: verdana,arial,sans-serif;\n                    font-size:11px;\n                    color:#333333;\n                    border-width: 1px;\n                    border-color: #999999;\n                    border-collapse: collapse;\n\n                }\n                .state-db-devtool table th {\n                    background:#b5cfd2;\n                    border-width: 1px;\n                    padding: 8px;\n                    border-style: solid;\n                    border-color: #999999;\n                }\n                .state-db-devtool table td {\n                    background:#dcddc0;\n                    border-width: 1px;\n                    padding: 8px;\n                    border-style: solid;\n                    border-color: #999999;\n                }\n            </style>\n            <div id=\"state-db-devtool-content\"  class=\"state-db-devtool-content\">\n                <select id=\"state-db-devtool-table-selector\">\n                    <option value=\"all\">all tables</option>\n                    ${tableNames.map(item => `<option value=\"${item}\">${item}</option>`)}\n                </select>\n                <input id=\"state-db-devtool-query-input\" type=\"text\">\n                <button id=\"state-db-devtool-query-submit\" >确认</button>\n                <div id=\"state-db-tables-wrapper\"></div>\n            </div>`;\n            document.body.appendChild(devtoolWrapper);\n        }\n\n        const renderData = () => {\n            const $tablesWrapper = $('#state-db-tables-wrapper');\n            $tablesWrapper.innerHTML = '';\n            if (state.tablename === 'all') {\n                methods.renderAll();\n            }\n            else if (state.tablename !== 'all' && !state.query) {\n                methods.renderTable(state.tablename);\n            }\n            else if (state.tablename !== 'all' && state.query) {\n\n            }\n        }\n\n        const bindEvent = () => {\n            const toggle = (el) => {\n                if (el.style.display==='none') {\n                    el.style.display = 'block'\n                }\n                else {\n                    el.style.display = 'none'\n                }\n            }\n            const $toggle = $('#state-db-devtool');\n            const $content = $('#state-db-devtool-content');\n            const $tableSelector = $('#state-db-devtool-table-selector');\n            const $refresh = $('#state-db-devtool-refresh');\n\n            $toggle.onclick = (e) => {\n                if (e.target === $toggle) {\n                    toggle($content)\n                }\n            }\n\n            $tableSelector.onchange = (e) => {\n                // $tablesWrapper.innerHTML = '';\n                if (state.tablename !== e.target.value) {\n                    state.tablename = e.target.value;\n                    renderData();\n                }\n            }\n        }\n        renderFramework();\n        renderData();\n        bindEvent();\n        tables.forEach(table => table.unbindFn(renderData));\n        tables.forEach(table => table.bindFn(renderData)); //触发自动变化\n\n    },\n\n    renderArr: (arr, tablename) => {\n        var $tablesWrapper = $('#state-db-tables-wrapper');\n        var $tableWrapper = document.createElement('div');\n        $tableWrapper.className = 'state-db-table-wrapper';\n\n        var getColumns = () => {\n            let columns = [];\n            arr.forEach(item => {\n                columns = columns.concat(Object.keys(item))\n            })\n            return [...new Set(columns)];\n        }\n        var renderColumns = () => {\n            var str = ''\n            getColumns().forEach(key => {\n                str = str + '<th>' + key + '</th>'\n            });\n            return str;\n        }\n        var renderValues = () => {\n            var renderItem = (item) => {\n                var str = '';\n                var columns = getColumns();\n                var strArr = [];\n                for (let i = 0; i < columns.length; i++) {\n                    strArr.push('<td></td>');\n                }\n                for (let i in item) {\n                    var index = columns.indexOf(i);\n                    if ( index > -1) {\n                        strArr[index] = `<td>${item[i]}</td>`;\n                    }\n                }\n                return strArr.join('');\n            }\n            var str = ''\n            arr.forEach(item => str += `<tr>${renderItem(item)}</tr>`)\n            return str;\n        }\n\n        if (arr.length) {\n            $tableWrapper.innerHTML = `\n            <p>表名：${tablename}，count: ${arr.length}</p>\n            <div class=\"state-db-table-scroll-wrapper\">\n                <table>\n                    <tr>${renderColumns()}</tr>\n                    ${renderValues()}\n                </table>\n            </div>`\n        }\n        $tablesWrapper.appendChild($tableWrapper);\n    },\n\n    renderItem: (line) => {\n        console.table(line)\n    }\n}\n\nexport default renderHTML;","var renderConsole = {\n    injectPage: (methods) => {\n        window.showTable = methods.renderTable\n        window.showTableAll = methods.renderAll\n        window.showTableLine = methods.renderLine\n    },\n    renderArr: (arr, tablename) => {\n        console.log('******** ' + tablename + ' ********* , item_count: ' + arr.length);\n        console.table(arr);\n    },\n    renderItem: (line, tablename) => console.table(line)\n}\n\nexport default renderConsole;","/*\n * 接收一个db实例\n */\nimport renderHTML from './render/renderHTML.js';\nimport renderConsole from './render/renderConsole.js';\n\nexport default (db, render=\"console\") => {\n    let renderer = {};\n    if (render==\"console\") {\n        renderer = renderConsole;\n    }\n    else if (render==\"html\") {\n        renderer = renderHTML;\n    }\n\n    const renderArr = renderer.renderArr;\n\n    const renderItem = renderer.renderItem;\n\n    const renderTable = (name) => {\n        renderArr(db.table(name).getValues(), name);\n    }\n\n    const renderAll = () => {\n        const tables = db.getTables()\n        for (let i in tables) {\n            renderTable(i);\n        }\n    }\n\n    const getInfo = () => {\n        const tables = db.getTables()\n        const tableNames = [];\n        const tableList = [];\n        for (let i in tables) {\n            tableNames.push(i);\n            tableList.push(tables[i]);\n        }\n        return {\n            tables: tableList,\n            tableNames: tableNames,\n            db: db\n        }\n    }\n\n    const renderLine = (tablename, query) => {\n        renderArr(db.table(tablename).where(query).getValues(), tablename);\n    }\n\n\n    const exportMethods = {\n        renderAll,\n        renderTable,\n        renderLine,\n        getInfo\n    }\n\n    renderer.injectPage(exportMethods);\n    db.bindFn(() => {\n        console.log('injectPage', db);\n        renderer.injectPage(exportMethods);\n    })\n}\n\n"],"names":["$","selector","document","querySelector","renderHTML","injectPage","methods","info","getInfo","tableNames","tables","db","state","query","tablename","renderFramework","body","removeChild","devtoolWrapper","createElement","setAttribute","className","innerHTML","icon","map","item","appendChild","renderData","$tablesWrapper","renderAll","renderTable","bindEvent","toggle","el","style","display","$toggle","$content","$tableSelector","$refresh","onclick","e","target","onchange","value","forEach","table","unbindFn","bindFn","renderArr","arr","$tableWrapper","getColumns","columns","concat","Object","keys","Set","renderColumns","str","key","renderValues","renderItem","strArr","i","length","push","index","indexOf","join","line","console","renderConsole","window","showTable","showTableAll","showTableLine","renderLine","log","render","renderer","name","getValues","getTables","tableList","where","exportMethods"],"mappings":"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"}